language: smalltalk
sudo: false

os:
  - linux

smalltalk:
  - Pharo-7.0

env:
  matrix:
  - JOB=test TYPE=System ARCHETYPE=book OUTPUT=pdf

install:
  - git clone https://github.com/pillar-markup/pillar.git -b v7.7.1 
# Run pillar build script. Pillar will be built in `pwd`/build!
  - cd pillar && ./scripts/build.sh && cd ..                              
# Install latex
  - . pillar/scripts/ci/ensure_latex.sh                                  
  # Install latex dependencies required by pillar
  - ./pillar/scripts/ci/ensure_book_dependencies.sh                       

script:
  - ./pillar/build/pillar build ${JOB}
  - if [[ ${JOB} == "html" ]]; then touch _result/html/.nojekyll; fi

after_success:
  - wget -c https://github.com/probonopd/uploadtool/raw/master/upload.sh
  - mv _result/pdf/book.pdf PillarBooklet-wip.pdf
  - bash upload.sh PillarBooklet-wip.pdf

branches:
  except:
    - /^(?i:continuous)$/
  

